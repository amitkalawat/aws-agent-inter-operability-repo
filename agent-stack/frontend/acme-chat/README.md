# ACME Chat Frontend

React TypeScript chat application for the ACME Corp Bedrock AgentCore chatbot.

## Features

- AWS Cognito authentication (USER_PASSWORD_AUTH flow)
- Real-time streaming responses from Bedrock AgentCore
- Markdown rendering with syntax highlighting
- Conversation memory persistence
- MCP tool integration (AWS Docs, Data Processing, MySQL CRM)

## Prerequisites

- Node.js 18+
- AWS CDK stack deployed (`AcmeAgentCoreStack`)

## Quick Start

### Development

```bash
# Install dependencies
npm install

# Create .env file (copy from example)
cp .env.example .env

# Start development server
npm start
```

The app runs at http://localhost:3000

### Production Deployment

Use the deploy script which auto-configures from CloudFormation:

```bash
./scripts/deploy-frontend.sh [stack-name] [region]

# Example (defaults to AcmeAgentCoreStack in us-west-2)
./scripts/deploy-frontend.sh
```

The script:
1. Fetches Cognito/Agent config from CloudFormation outputs
2. Generates `.env` with correct values
3. Builds the production bundle
4. Syncs to S3 bucket
5. Invalidates CloudFront cache

## Configuration

Environment variables (auto-generated by `deploy-frontend.sh`):

| Variable | Description |
|----------|-------------|
| `REACT_APP_COGNITO_USER_POOL_ID` | Cognito User Pool ID |
| `REACT_APP_COGNITO_APP_CLIENT_ID` | Cognito App Client ID |
| `REACT_APP_AWS_REGION` | AWS region (us-west-2) |
| `REACT_APP_AGENTCORE_ARN` | Bedrock AgentCore Agent ARN |

## Project Structure

```
src/
├── components/
│   ├── ChatInterface.tsx    # Main chat UI
│   ├── LoginForm.tsx        # Cognito login form
│   └── Header.tsx           # Navigation header
├── services/
│   ├── AuthService.ts       # Cognito authentication
│   └── AgentCoreService.ts  # Agent invocation API
├── App.tsx                  # Root component
└── index.tsx                # Entry point
```

## Authentication

The app uses direct Cognito API calls with `USER_PASSWORD_AUTH` flow instead of Hosted UI. This works reliably with admin-created users.

```typescript
// Login via Cognito API
const response = await authService.login(email, password);
```

## Scripts

| Command | Description |
|---------|-------------|
| `npm start` | Start development server |
| `npm run build` | Create production build |
| `npm test` | Run tests |
| `./scripts/deploy-frontend.sh` | Deploy to S3/CloudFront |
| `./scripts/generate-env.sh` | Generate .env from CloudFormation |

## Troubleshooting

### "Cannot find asset at build/"

The CDK stack requires the frontend to be built first:

```bash
npm run build
cd ../../cdk && cdk deploy AcmeAgentCoreStack
```

### Stale Configuration

If login fails after stack recreation, regenerate config:

```bash
./scripts/deploy-frontend.sh
```

### CloudFront Cache

After deployment, wait 1-2 minutes for CloudFront cache invalidation to complete.
